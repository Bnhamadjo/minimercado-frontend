<h2 class="estoque-titulo">ğŸ“¦ MovimentaÃ§Ãµes de Estoque</h2>

<!-- Registro de movimentaÃ§Ã£o -->
<form (ngSubmit)="registrarMovimentacao()" class="registro-form">
  <div class="form-group">
    <label>Produto:</label>
    <select [(ngModel)]="novaMovimentacao.produto_id" name="produto_id" required>
      <option *ngFor="let p of produtos" [value]="p.id">{{ p.nome }}</option>
    </select>
  </div>
  <div class="form-group">
    <label>Tipo:</label>
    <select [(ngModel)]="novaMovimentacao.tipo" name="tipo">
      <option value="entrada">Entrada</option>
      <option value="saida">SaÃ­da</option>
    </select>
  </div>
  <div class="form-group">
    <label>Quantidade:</label>
    <input type="number" [(ngModel)]="novaMovimentacao.quantidade" name="quantidade" required min="1" />
  </div>

  <div *ngIf="novaMovimentacao.tipo === 'entrada'" class="form-group">
  <label for="data_validade">Data de Validade</label>
  <input
    type="date"
    id="data_validade"
    [(ngModel)]="novaMovimentacao.data_validade"
    name="data_validade"
    class="form-control"
  />
</div>


  <div class="form-group">
    <label>Motivo:</label>
    <input type="text" [(ngModel)]="novaMovimentacao.motivo" name="motivo" />
  </div>
  <button type="submit" class="btn-registrar">âœ… Registrar</button>
</form>

<h2 class="estoque-titulo">ğŸ“¦ Filtro de produtos</h2>
<!-- Filtro -->
<form (ngSubmit)="buscarMovimentacoes()" class="filtro-form">
  <div class="form-group">
    <label>Data InÃ­cio:</label>
    <input type="date" [(ngModel)]="filtros.data_inicio" name="data_inicio" />
  </div>
  <div class="form-group">
    <label>Data Fim:</label>
    <input type="date" [(ngModel)]="filtros.data_fim" name="data_fim" />
  </div>
  <div class="form-group">
    <label>Tipo:</label>
    <select [(ngModel)]="filtros.tipo" name="tipo">
      <option value="">Todos</option>
      <option value="entrada">Entrada</option>
      <option value="saida">SaÃ­da</option>
    </select>
  </div>
  <button type="submit" class="btn-filtrar">ğŸ” Filtrar</button>
  <button type="button" (click)="exportarExcel()" class="btn-filtrar">ğŸ“¥ Exportar Excel</button>
</form>

<!-- Tabela -->
<table class="tabela-movimentacoes" *ngIf="movimentacoes.length > 0">
  <thead>
    <tr>
      <th>Data/Hora</th>
      <th>Produto</th>
      <th>Tipo</th>
      <th>Quantidade</th>
      <th>OperaÃ§Ã£o</th>
      <th>Estoque Atual</th>
      <th>Total Vendido</th>
      <th>Validade</th>
      <th>Aviso</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let m of movimentacoesPaginadas">
      <td>{{ m.created_at | date:'short' }}</td>
      <td>
        <a (click)="abrirDetalhes(m.produto.id)" class="link-detalhe">
          {{ m.produto.nome }}
        </a>
      </td>
      <td>{{ m.tipo }}</td>
      <td>{{ m.quantidade }}</td>
      <td title="{{ m.motivo }}">{{ m.motivo }}</td>
      <td [ngClass]="{
      'estoque-negativo': getEstoque(m.produto.id) < 0,
      'estoque-positivo': getEstoque(m.produto.id) >= 0
    }">
  {{ getEstoque(m.produto.id) }}
</td>
      <td>{{ getTotalVendido(m.produto.id) }}</td>
      <td>{{ m.data_validade ? (m.data_validade | date: 'dd/MM/yyyy') : '-' }}</td>
      <td>{{ getAvisoValidade(m.data_validade) }}</td>
    </tr>
  </tbody>
</table>

<!-- Controles de paginaÃ§Ã£o -->
<div class="paginacao" *ngIf="totalPaginas > 1">
  <button (click)="paginaAnterior()" [disabled]="paginaAtual === 1">â¬…ï¸ Anterior</button>
  <span>PÃ¡gina {{ paginaAtual }} / {{ totalPaginas }}</span>
  <button (click)="proximaPagina()" [disabled]="paginaAtual === totalPaginas">PrÃ³xima â¡ï¸</button>
</div>


